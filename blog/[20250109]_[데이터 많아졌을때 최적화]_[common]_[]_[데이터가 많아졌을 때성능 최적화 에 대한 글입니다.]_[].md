# 데이터가 많아졌을 때 성능 최적화

## 문제 개요
- **스레드 풀 부족**:
  - DB 작업이 처리되지 않고 일정 기간 보류되면 스레드 풀이 부족해지고 에러 발생 가능.
- **로스트 업데이트 문제**:
  - **로우 락 쿼리**를 통해 해결 및 예방 가능.
- **대규모 데이터 처리**:
  - 예) 유저별 큐에 1만 개 데이터가 쌓이는 상황.
  - 월간 액티브 유저가 백만 명인 경우, 조회 성능 저하 위험.

## 주요 해결 방안
1. **캐싱**:
   - 반복적으로 조회되는 데이터를 메모리에 저장하여 DB 조회 부담 경감.
2. **인덱스**:
   - DB 조회 성능을 비약적으로 향상.
   - 적절한 인덱스 설정은 성능 최적화뿐만 아니라 장애 예방에도 도움.

---

## 인덱스와 성능 최적화

### 인덱스 작용 구조
- **MySQL의 B+트리 구조**:
  - 구성:
    - **루트 노드** → **브랜치 노드** → **리프 노드**.
  - 리프 노드에는 데이터가 아니라 인덱스 정보가 저장됨.
  - **주의점**:
    - 전체 데이터의 20% 이상이 인덱스로 설정된 경우, 인덱스 탐색이 전체 테이블 스캔보다 느려질 수 있음.

### 인덱스 생성 시 주의사항
1. **칼럼 순서**:
   - 인덱스에 포함된 칼럼의 순서에 따라 실행 계획이 변경되거나 쿼리가 실행되지 않을 수 있음.
2. **사용 사례**:
   - WHERE 조건이나 JOIN, ORDER BY, GROUP BY에 자주 사용되는 칼럼에 대해 설정.

### 인덱스의 탐색 방식
- **인덱스 레인지 스캔**:
  - 검색할 **인덱스 범위가 확정**된 경우 사용.
  - 조건에 따라 빠른 검색이 가능.

---

## 주니어 개발자의 흔한 실수
- **데이터 누적 문제**:
  - 현업에서는 데이터 누적으로 인한 성능 저하 및 장애가 빈번.
  - 정기적인 데이터 삭제 및 아카이빙, 인덱스 재조정 필요.

---

## 성능 최적화 요약
- 적절한 **캐싱 전략**을 도입하여 불필요한 DB 요청을 최소화.
- **인덱스** 설정 시 범위 및 칼럼 순서를 신중히 고려.
- 정기적으로 데이터를 관리하고, 스레드 풀 설정을 최적화.
- 부하 테스트와 성능 모니터링 도구를 활용하여 문제를 사전에 감지하고 해결.
